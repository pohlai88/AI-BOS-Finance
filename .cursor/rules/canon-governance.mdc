---
description: Canon Identity & Governance Rules (CONT_01)
globs: ["**/*.tsx", "**/*.ts", "**/*.yaml", "**/*.md"]
alwaysApply: true
---

> **üü¢ [ACTIVE]** ‚Äî Cursor Rule Enforcer  
> **Derives From:** CONT_01 v2.2.0  
> **Purpose:** IDE enforcement of Canon Identity rules  
> **Scope:** All TS/TSX/YAML/MD files  
> **Always Apply:** Yes

---

# Canon Governance Rules

## SSOT Reference
- **Contract:** CONT_01 v2.2.0
- **Location:** `canon/contracts/CONT_01_CanonIdentity.md`
- **Verification:** `npx tsx scripts/TOOL_03_CheckGovernanceStamps.ts`

## Canon Identity Codes

### Plane A ‚Äî Governance
- `CONT_XX` - Contracts (immutable law)
- `ADR_XXX` - Architecture Decision Records

### Plane B ‚Äî Functional
- `PAGE_<Code>` or `<Code>` - Routable screens (e.g., `META_02`, `PAY_01`)
- `COMP_<Code>` - UI Components (e.g., `TBLM01`, `TBLL01`)
- `CELL_<PAGE>_<SCH>_<TAB>_<POLY>` - Atomic governed units

### Plane C ‚Äî Data & Logic
- `ENT_XXX` - Database entities
- `SCH_XXX` - Validation schemas (Zod)
- `POLY_XX` - Business policies
- `CONST_XX` - Static constants

### Plane D ‚Äî Operations
- `TOOL_XX` - Scripts and CLI tools
- `MIG_YYYYMMDD_Slug` - Database migrations
- `INFRA_XX` - Infrastructure as Code

### Plane E ‚Äî Knowledge
- `SPEC_XXX` - Feature specifications
- `REF_XXX` - External references

## Required Exports

### Pages (in `canon-pages/`)
```typescript
export const PAGE_META = {
  code: 'META_02',
  version: '1.0.0',
  name: 'Page Name',
  route: '/route',
  domain: 'METADATA',
  status: 'active',
} as const satisfies PageMeta;
```

### Components (in `packages/ui/canon/`)
```typescript
export const COMPONENT_META = {
  code: 'TBLM01',
  version: '1.0.0',
  family: 'TABLE',
  purpose: 'MONETIZE',
  status: 'active',
} as const satisfies ComponentMeta;
```

## File Creation Workflow

### ‚ö†Ô∏è CRITICAL: Staging Documentation First

**ALL new documentation files MUST be created in `.staging-docs/` first, NOT directly in `canon/` or root.**

**Workflow:**
1. **Create file in `.staging-docs/`** (mirroring canon structure directly at root)
   - Example: `.staging-docs/A-Governance/A-ADR/ADR_003_NewDecision.md`
2. **Developer reviews and approves**
3. **Promote to canon:** `npm run canon:promote <file-path>`
4. **File is now governed by Canon rules**

**Why:**
- Prevents root directory clutter
- Ensures review before Canon governance applies
- Files in `.staging-docs/` are NOT tracked by Git
- Files in `.staging-docs/` are NOT validated by Canon

**Directory Mapping:**
```
.staging-docs/A-Governance/A-ADR/  ‚Üí  canon/A-Governance/A-ADR/
.staging-docs/B-Functional/B-COMP/ ‚Üí  canon/B-Functional/B-COMP/
.staging-docs/C-DataLogic/C-SCH/   ‚Üí  canon/C-DataLogic/C-SCH/
.staging-docs/D-Operations/D-TOOL/ ‚Üí  canon/D-Operations/D-TOOL/
.staging-docs/E-Knowledge/E-REF/    ‚Üí  canon/E-Knowledge/E-REF/
```

## Forbidden Patterns
- ‚ùå **NEVER create files directly in `canon/` directory** - use `.staging-docs/` first
- ‚ùå **NEVER create documentation files at project root** - use `.staging-docs/` instead
- ‚ùå **NEVER write files outside `src/` directory** - only `src/` is writable (see `file-access-control.mdc`)
- ‚ùå Never trust client-side `CanonContext` - always verify server-side
- ‚ùå Never import raw `@tanstack/react-table` - use `TBLM01` or `TBLL01`
- ‚ùå Never create pages in `canon-pages/` without `PAGE_META`
- ‚ùå Never assign Canon IDs to framework configs (`package.json`, etc.)

## Directory Structure
```
canon/contracts/      # CONT_*, ADR_*
canon/registry/       # YAML manifests
apps/web/canon-pages/ # PAGE_* implementations
packages/ui/canon/    # COMP_* implementations
scripts/              # TOOL_* scripts
knowledge/            # SPEC_*, REF_*
```

## D-TOOL Directory Rules (Strengthened)

### Tool Classification
- **Every tool MUST be classified** in `tool-metadata.json`
- **Categories:** `migration` | `cleanup` | `validation` | `sync` | `utility`
- **Status:** `active` | `archived` | `deprecated`

### Archive Policy
- ‚úÖ **One-time tools** (migrations, cleanups) ‚Üí Archive after completion
- ‚úÖ **Maximum 15-20 active tools** in D-TOOL directory
- ‚úÖ **Archived tools** go to `canon/D-Operations/D-TOOL/.archive/`
- ‚ùå **Never keep one-time tools** in active directory after completion

### Tool Naming
- **Pattern:** `TOOL_{NUMBER}_{Purpose}.ts`
- **Examples:** `TOOL_18_ValidateCanonCompliance.ts`, `TOOL_30_ArchiveOneTimeTools.ts`

### Archive Management
```bash
# Archive one-time tools
npm run canon:archive-tools

# View archived tools
ls canon/D-Operations/D-TOOL/.archive/
```

**See:** `REF_041_CanonDirectoryCleanupStrategy.md` for full details
